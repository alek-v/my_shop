<?php

/**
 * How to run this script
 * Open terminal and run a command written below:
 * php install database_hostname database_username database_password database_name
 */

// Database settings
// Use 127.0.0.1 for hostname if localhost doesn't work
$db_hostname = $argv[1];
$db_username = $argv[2];
$db_password = $argv[3];
$db_database = $argv[4];

$mysqli = new mysqli($db_hostname, $db_username, $db_password, $db_database);
$mysqli->set_charset('utf8mb4');

echo "Creating tables...\r\n";
// Wait a little bit to see what is happening
sleep(2);

// Insert table in the database
$products_table = "CREATE TABLE products( ".
    "product_id INT NOT NULL AUTO_INCREMENT, ".
    "product_title VARCHAR(255) NOT NULL, ".
    "product_description TEXT NOT NULL, ".
    "items_available INT, ".
    "PRIMARY KEY ( product_id )) " .
    "ENGINE=InnoDB DEFAULT CHARSET=utf8mb4;";
if ($mysqli->query($products_table)) {
    echo "Table products created successfully.\r\n\r\n";
}

echo "Importing data into tables...\r\n";
sleep(2);

// List of the products
$product_rows = [
    ['Red Shirt', 'Red shirt 100% cotton.', 15],
    ['Blue Shirt', 'Original blue shirt.', 6],
    ['Men\'s V-Neck Shirt', 'V-neck shirt from a new collection.', 11]
];

// Import products into database
// Prepare statement
$stmt = $mysqli->prepare("INSERT INTO products (product_title, product_description, items_available) VALUES (?, ?, ?)");

// Count number of imported products
$total_products_imported = 0;

foreach ($product_rows as $product_row) {
    $product_title = $product_row[0];
    $product_description = $product_row[1];
    $items_available = $product_row[2];

    $stmt->bind_param('ssi',$product_title,$product_description, $items_available);
    if ($stmt->execute()) {
        echo "Product {$product_title} has been successfully imported into database.\r\n";
    }

    $total_products_imported++;
}

echo "Total products imported: {$total_products_imported}\r\n";